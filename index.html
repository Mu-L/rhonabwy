<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rhonabwy: Rhonabwy API documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rhonabwy
   </div>
   <div id="projectbrief">Create, modify, parse or export Json Web Keys as defined in the RFC 7517</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Rhonabwy API documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Rhonabwy library is made to manage JWK, JWKS, JWS, JWE and JWT according to their respective RFCs:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7517">JSON Web Keys</a> (JWK) and JSON Web Keys Set (JWKS)</li>
<li><a href="https://tools.ietf.org/html/rfc7515">JSON Web Signatures</a> (JWS)</li>
<li><a href="https://tools.ietf.org/html/rfc7516">JSON Web Encryption</a> (JWE) <b>limited and experimental!</b></li>
<li><a href="https://tools.ietf.org/html/rfc7519">JSON Web Token</a> (JWT)</li>
</ul>
<p>Rhonabwy is based on the following libraries and actively uses them:</p>
<ul>
<li>GnuTLS for the cryptographic functions</li>
<li>Jansson for the JSON manipulation</li>
<li>Yder for the logs</li>
<li>Ulfius when it requires to retrieve keys from an URL</li>
</ul>
<p>When relevant, a function can accept or return GnuTLS or Jansson data. But if you're not using those in your application and prefer raw data, you can use the more agnostic functions.</p>
<h2>Return values</h2>
<p>Lots of functions in Rhonabwy library return an int value. The returned value can be one of the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define RHN_OK                 0</span></div><div class="line"><span class="preprocessor">#define RHN_ERROR              1</span></div><div class="line"><span class="preprocessor">#define RHN_ERROR_MEMORY       2</span></div><div class="line"><span class="preprocessor">#define RHN_ERROR_PARAM        3</span></div><div class="line"><span class="preprocessor">#define RHN_ERROR_UNSUPPORTED  4</span></div><div class="line"><span class="preprocessor">#define RHN_ERROR_INVALID      5</span></div></div><!-- fragment --><p>If a function is succesfull, it will return <code>RHN_OK</code> (0), otherwise an error code is returned.</p>
<h2>Log messages</h2>
<p>Usually, a log message is displayed to explain more specifically what happened on error. The log manager used is <a href="https://github.com/babelouest/yder">Yder</a>. You can enable yder log messages on the console with the following command at the beginning of your program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  y_init_logs(<span class="stringliteral">&quot;Rhonabwy&quot;</span>, Y_LOG_MODE_CONSOLE, Y_LOG_LEVEL_DEBUG, NULL, <span class="stringliteral">&quot;Starting Rhonabwy client program&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Do your code here</span></div><div class="line"></div><div class="line">  y_close_logs();</div><div class="line">}</div></div><!-- fragment --><p>Example of an error log message:</p>
<div class="fragment"><div class="line">2020-04-05T16:14:31 - Rhonabwy: r_jwk_is_valid - Invalid alg</div></div><!-- fragment --><p>Go to Yder <a href="https://babelouest.github.io/yder/">API Documentation</a> for more details.</p>
<h2>Memory management</h2>
<p>All typedefs managed by Rhonabwy use dedicated init and free functions. You must always use those functions to allocate or free resources manipulated by the library.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> ** jwk);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga6d62f61c18adafd2faec28c3e76bfc7b">r_jwks_init</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> ** jwks);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga6035f53cdffed4076b5d085e8172025f">r_jwks_free</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a>(<a class="code" href="structjws__t.html">jws_t</a> ** jws);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(<a class="code" href="structjwe__t.html">jwe_t</a> ** jwe);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(<a class="code" href="structjwe__t.html">jwe_t</a> * jwe);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(<a class="code" href="structjwt__t.html">jwt_t</a> ** jwt);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt);</div></div><!-- fragment --><p>In addition, when a function return a <code>char *</code> value, this value must be free'd using the function <code><a class="el" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free(void *)</a></code>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(<span class="keywordtype">void</span> * data);</div></div><!-- fragment --><h2>Libary information</h2>
<p>The functions <code><a class="el" href="group__core.html#ga0131b3af376db952a7f919066b4b19a2">r_library_info_json_t()</a></code> and <code><a class="el" href="group__core.html#ga038285cdde2dac92e67ae762f5615f60">r_library_info_json_str()</a></code> return a JSON object that represents the signature and encryption algorithms supported, as well as the library version.</p>
<p>Example output:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;version&quot;: &quot;0.9.8&quot;,</div><div class="line">  &quot;jws&quot;: {</div><div class="line">    &quot;alg&quot;: </div><div class="line">      [&quot;none&quot;,</div><div class="line">      &quot;HS256&quot;,</div><div class="line">      &quot;HS384&quot;,</div><div class="line">      &quot;HS512&quot;,</div><div class="line">      &quot;RS256&quot;,</div><div class="line">      &quot;RS384&quot;,</div><div class="line">      &quot;RS512&quot;]</div><div class="line">  },</div><div class="line">  &quot;jwe&quot;: {</div><div class="line">    &quot;alg&quot;: </div><div class="line">      [&quot;RSA1_5&quot;,</div><div class="line">      &quot;dir&quot;],</div><div class="line">    &quot;enc&quot;:</div><div class="line">      [&quot;A128CBC-HS256&quot;,</div><div class="line">      &quot;A192CBC-HS384&quot;,</div><div class="line">      &quot;A256CBC-HS512&quot;,</div><div class="line">      &quot;A128GCM&quot;,</div><div class="line">      &quot;A256GCM&quot;]</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>And finally, all <code>json_t *</code> returned values must be deallocated using <code>json_decref(json_t *)</code>, see <a href="https://jansson.readthedocs.io/">Jansson Documentation</a> for more details.</p>
<h2>JWK</h2>
<p>A JWK (JSON Web Key) is a format used to store and represent a cryptoraphic key in a JSON object.</p>
<p>Example of JWK:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;kty&quot;:&quot;EC&quot;,</div><div class="line">  &quot;crv&quot;:&quot;P-256&quot;,</div><div class="line">  &quot;x&quot;:&quot;f83OJ3D2xF1Bg8vub9tLe1gHMzV76e8Tus9uPHvRVEU&quot;,</div><div class="line">  &quot;y&quot;:&quot;x_FEzRu9m36HLN_tue659LNpXW6pCyStikYjKIWI5a0&quot;,</div><div class="line">  &quot;kid&quot;:&quot;Public key used in JWS spec Appendix A.3 example&quot;</div><div class="line">}</div></div><!-- fragment --><p>The standard allows to store public and private keys for RSA and ECC algorithms, it also allows to store symmetric keys. In a JWK, every raw value is encoded in Base64Url format to fit in the JSON object without any issue.</p>
<p>A JWK is represented in Rhonabwy library using the type <code>jwk_t *</code>.</p>
<h3>Import and Export JWK</h3>
<p>Rhonabwy allows to import and export a JWK in the following formats:</p><ul>
<li>A JSON structure in a <code>const char *</code></li>
<li>A JSON structure in a <code>json_t *</code></li>
<li>A key or certificate in <code>PEM</code> or <code>DER</code> format</li>
<li>A <code>GnuTLS</code> structure of the following: <code>gnutls_privkey_t</code>, <code>gnutls_pubkey_t</code> or <code>gnutls_x509_crt_t</code> (import only)</li>
</ul>
<p>If the imported JWK contains a <code>x5u</code> property, the key or certificate will be downloaded at the given address. If so, you can give an additional parameter <code>x5u_flag</code> which values can be:</p><ul>
<li><code>R_FLAG_IGNORE_SERVER_CERTIFICATE</code>: ignrore if web server certificate is invalid</li>
<li><code>R_FLAG_FOLLOW_REDIRECT</code>: follow redirections if necessary</li>
<li><code>R_FLAG_IGNORE_REMOTE</code>: do not download remote key, but the function may return an error</li>
</ul>
<p>The values <code>R_FLAG_IGNORE_SERVER_CERTIFICATE</code> and <code>R_FLAG_FOLLOW_REDIRECT</code> can be merged: <code>R_FLAG_IGNORE_SERVER_CERTIFICATE|R_FLAG_FOLLOW_REDIRECT</code></p>
<h3>Manipulate JWK properties</h3>
<p>You can manipulate the JWK properties directly using the dedicated functions:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__jwk__properties.html#ga4d0a505baa8e441a70490840fb880ee6">r_jwk_get_property_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__jwk__properties.html#gaf6cd637cf88d511d547a146e10d8bb0a">r_jwk_get_property_array</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> index);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#gae4caae9a7017e947f9ed9fd637926c76">r_jwk_set_property_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#ga36b7d9e1f3569efcef659e4b82c7355c">r_jwk_set_property_array</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> index, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#ga85b06a928093bcc8352f293ef5bf2450">r_jwk_append_property_array</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#ga572be5228d9f1302ef47c1f51de1ac8c">r_jwk_delete_property_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#gafea3b8f0536a37bd4024d5ac76238016">r_jwk_delete_property_array_at</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> index);</div></div><!-- fragment --><h3>Validate the format of a JWK</h3>
<p>The function <code>r_jwk_is_valid</code> will check the validity of a JWK, i.e. check if all the required properties are present and in the correct format. Note that this function is called each time an import is made.</p>
<h3>Generate a random key pair</h3>
<p>You can use Rhonabwy to generate a random key pair for RSA or ECC algorithms. The <code>jwk_t *</code> parameters must be initialized first.</p>
<p>The <code>type</code> parameter can have one of the following values: <code>R_KEY_TYPE_RSA</code> or <code>R_KEY_TYPE_ECDSA</code>. The <code>bits</code> parameter specifies the length of the key. A RSA key must be at least 2048 bits, and the bits value allowed for an ECC key are 256, 384 or 512.</p>
<p>If the parameter <code>kid</code> is used, the generated key kid property will heve the kid specified, otherwise a <code>kid</code> will be generated to identify the key pair.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__validate.html#ga506e98d70cc77ba0ed2b012bcaee14f3">r_jwk_generate_key_pair</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_privkey, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_pubkey, <span class="keywordtype">int</span> type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bits, <span class="keyword">const</span> <span class="keywordtype">char</span> * kid);</div></div><!-- fragment --><h2>JWKS</h2>
<p>A JWKS (JSON Web Key Set) is a format used to store and represent a set cryptoraphic key in a JSON object. A JWKS is always a JSON object containing the property <code>"keys"</code> that will point to an array of JWK.</p>
<p>Example of JWKS:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;keys&quot;:</div><div class="line">  [</div><div class="line">    {</div><div class="line">      &quot;kty&quot;:&quot;EC&quot;,</div><div class="line">      &quot;crv&quot;:&quot;P-256&quot;,</div><div class="line">      &quot;x&quot;:&quot;MKBCTNIcKUSDii11ySs3526iDZ8AiTo7Tu6KPAqv7D4&quot;,</div><div class="line">      &quot;y&quot;:&quot;4Etl6SRW2YiLUrN5vfvVHuhp7x8PxltmWWlbbM4IFyM&quot;,</div><div class="line">      &quot;use&quot;:&quot;enc&quot;,</div><div class="line">      &quot;kid&quot;:&quot;1&quot;</div><div class="line">    },</div><div class="line">    {</div><div class="line">      &quot;kty&quot;:&quot;RSA&quot;,</div><div class="line">      &quot;n&quot;: &quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRXjBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw&quot;,</div><div class="line">      &quot;e&quot;:&quot;AQAB&quot;,</div><div class="line">      &quot;alg&quot;:&quot;RS256&quot;,</div><div class="line">      &quot;kid&quot;:&quot;2011-04-29&quot;</div><div class="line">    }</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><p>In Rhonabwy library, you can manipulate the JWKs inside a JWKS by iteration or get a JWK by its kid.</p>
<div class="fragment"><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * <a class="code" href="group__jwks.html#gaccfb6d0b8d071c92ceeb5c7bd48047e5">r_jwks_get_at</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keywordtype">size_t</span> index);</div><div class="line"></div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * <a class="code" href="group__jwks.html#ga7846e6ec4d66f2baec08a6900dd55f02">r_jwks_get_by_kid</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keyword">const</span> <span class="keywordtype">char</span> * kid);</div></div><!-- fragment --><p>You can also import a JWKS using a JSON object or an URL.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwks.html#ga3779f3432ca378e4db6fd338a86eaa21">r_jwks_import_from_str</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keyword">const</span> <span class="keywordtype">char</span> * input);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwks.html#ga6c32c46305421cf0eed3c6f3ea91a798">r_jwks_import_from_json_t</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, json_t * j_input);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwks.html#ga0788a318f26b8c9a252916747c27898a">r_jwks_import_from_uri</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keyword">const</span> <span class="keywordtype">char</span> * uri, <span class="keywordtype">int</span> flags);</div></div><!-- fragment --><h2>JWS</h2>
<p>A JWS (JSON Web Signature) is a content digitally signed and serialized in a compact format that can be easily transferred in HTTP requests.</p>
<p>A JWS has 3 elements serialized in base64url format and separated by a dot (.). The 3 elements are:</p>
<ul>
<li>A header in JSON format</li>
<li>A Payload</li>
<li>A digital signature</li>
</ul>
<p>Its representaiotn uses the following format:</p>
<p>BASE64URL(UTF8(JWS Protected Header)) || '.' || BASE64URL(JWS Payload) || '.' || BASE64URL(JWS Signature)</p>
<p>The signature is based on the following data:</p>
<p>BASE64URL(UTF8(JWS Protected Header)) || '.' || BASE64URL(JWS Payload)</p>
<p>The algorithms supported by Rhonabwy are the following:</p><ul>
<li>HMAC with SHA-2 Functions: <code>HS256</code>, <code>HS384</code>, <code>HS512</code></li>
<li>Digital Signature with RSASSA-PKCS1-v1_5: <code>RS256</code>, <code>RS384</code>, <code>RS512</code></li>
<li>Digital Signature with ECDSA: <code>ES256</code>, <code>ES384</code>, <code>ES512</code></li>
<li>Digital Signature with RSASSA-PSS: <code>PS256</code>, <code>PS384</code>, <code>PS512</code></li>
<li>Digital Signature with Ed25519 Elliptic Curve: <code>EDdSA</code></li>
<li>Unsecured: <code>none</code></li>
</ul>
<h3>JWS example</h3>
<p>In this example, the payload used is the following message:</p>
<div class="fragment"><div class="line">The true sign of intelligence is not knowledge but imagination.</div></div><!-- fragment --><p>The JWS will be signed using HMAC with SHA256 algorithm, in this example, the signing process will use a key identified by the kid "1", therefore the header is the following:</p>
<div class="fragment"><div class="line">{&quot;alg&quot;:&quot;HS256&quot;,&quot;kid&quot;:&quot;1&quot;}</div></div><!-- fragment --><p>The key used to sign the data is the following:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;kty&quot;:&quot;oct&quot;,</div><div class="line">  &quot;alg&quot;:&quot;HS256&quot;,</div><div class="line">  &quot;k&quot;:&quot;c2VjcmV0&quot;,</div><div class="line">  &quot;kid&quot;:&quot;1&quot;</div><div class="line">}</div></div><!-- fragment --><p>Finally, the complete representation of the JWS is the following:</p>
<div class="fragment"><div class="line">eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.VGhlIHRydWUgc2lnbiBvZiBpbnRlbGxpZ2VuY2UgaXMgbm90IGtub3dsZWRnZSBidXQgaW1hZ2luYXRpb24u.GKxWqRBFr-6X4HfflzGeGvKVsJ8v1-J39Ho2RslC-5o</div></div><!-- fragment --><h3>Serialize a JWS using Rhonabwy</h3>
<p>The JWS above can be created with the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjws__t.html">jws_t</a> * jws = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_symmetric = NULL;</div><div class="line"><span class="keywordtype">char</span> * token = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;The true sign of intelligence is not knowledge but imagination.&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_key_symmetric_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;alg\&quot;:\&quot;HS256\&quot;,\&quot;k\&quot;:\&quot;c2VjcmV0\&quot;,\&quot;kid\&quot;:\&quot;1\&quot;}&quot;</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_symmetric) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a>(&amp;jws) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_symmetric, jwk_key_symmetric_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jws.html#gaec9fca6a5ba8aa2fe7077b127464e428">r_jws_set_alg</a>(jws, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jws.html#gad0aa1c6b7fa0b8d34028059b5770fc01">r_jws_set_payload</a>(jws, payload, <span class="keyword">sizeof</span>(payload)) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div><div class="line">  token = <a class="code" href="group__jws.html#gaaca013bc2c9c3fe1e85386187504b235">r_jws_serialize</a>(jws, jwk_key_symmetric, 0); <span class="comment">// token will store the signed token</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div><div class="line"><a class="code" href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a>(jws);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_symmetric);</div></div><!-- fragment --><h3>Parse and validate signature of a JWS using Rhonabwy</h3>
<p>The JWS above can be parsed and verified using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjws__t.html">jws_t</a> * jws = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_symmetric = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> token[] = <span class="stringliteral">&quot;eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.&quot;</span></div><div class="line"><span class="stringliteral">&quot;VGhlIHRydWUgc2lnbiBvZiBpbnRlbGxpZ2VuY2UgaXMgbm90IGtub3dsZWRnZSBidXQgaW1hZ2luYXRpb24u.&quot;</span></div><div class="line"><span class="stringliteral">&quot;GKxWqRBFr-6X4HfflzGeGvKVsJ8v1-J39Ho2RslC-5o&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_key_symmetric_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;alg\&quot;:\&quot;HS256\&quot;,\&quot;k\&quot;:\&quot;c2VjcmV0\&quot;,\&quot;kid\&quot;:\&quot;1\&quot;}&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * payload = NULL;</div><div class="line"><span class="keywordtype">size_t</span> payload_len = 0;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_symmetric) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a>(&amp;jws) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_symmetric, jwk_key_symmetric_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jws.html#gae1b043a46071322f988c8d714883a208">r_jws_parse</a>(jws, token, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jws.html#ga2f4b76d9600759ef920c0d389ae19fda">r_jws_verify_signature</a>(jws, jwk_key_symmetric, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    (payload = <a class="code" href="group__jws.html#ga6373deaab8fecce87cc7adc44062ca91">r_jws_get_payload</a>(jws, &amp;payload_len)) != NULL &amp;&amp; payload_len &gt; 0) {</div><div class="line">    <span class="comment">// payload and payload_len will contain the payload data</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a>(jws);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_symmetric);</div></div><!-- fragment --><h2>JWE</h2>
<p>A JWE (JSON Web Encryption) is an encrypted content serialized in a compact format that can be easily transferred in HTTP requests.</p>
<p>Basically the payload is encrypted using AES-CBC or AES-GCM and an Initialization Vector (IV), a authentication tag is generated to validate the decryption, and the AES key used to encrypt the payload is encrypted itself using a symmetric or asymmetric encryption algorithm.</p>
<p>The serialized token has the following format:</p>
<p>BASE64URL(UTF8(JWE Protected Header)) || '.' || BASE64URL(JWE Encrypted Key) || '.' || BASE64URL(JWE Initialization Vector) || '.' || BASE64URL(JWE Ciphertext) || '.' || BASE64URL(JWE Authentication Tag)</p>
<p>In Rhonabwy library, the supported algorithms are the following:</p><ul>
<li>Supported Encryption Algorithm (<code>enc</code>) for JWE payload encryption: <code>A128CBC-HS256</code>, <code>A192CBC-HS384</code>, <code>A256CBC-HS512</code>, <code>A128GCM</code>, <code>A256GCM</code></li>
<li>Supported Cryptographic Algorithms for Key Management: <code>RSA1_5</code> (RSAES-PKCS1-v1_5), <code>dir</code> (Direct use of a shared symmetric key), <code>A128GCMKW</code> and <code>A256GCMKW</code></li>
</ul>
<p>If you don't specify a Content Encryption Key or an Initialization Vector before the serialization, Rhonabwy will automatically generate one or the other or both depending on the algorithm specified.</p>
<h3>JWE example</h3>
<p>In this example, the payload used is the following message:</p>
<div class="fragment"><div class="line">The true sign of intelligence is not knowledge but imagination.</div></div><!-- fragment --><p>The RSA private key associated to this token is:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;kty&quot;:&quot;RSA&quot;,</div><div class="line">  &quot;n&quot;:&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRXjBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw&quot;,</div><div class="line">  &quot;e&quot;:&quot;AQAB&quot;,</div><div class="line">  &quot;d&quot;:&quot;X4cTteJY_gn4FYPsXB8rdXix5vwsg1FLN5E3EaG6RJoVH-HLLKD9M7dx5oo7GURknchnrRweUkC7hT5fJLM0WbFAKNLWY2vv7B6NqXSzUvxT0_YSfqijwp3RTzlBaCxWp4doFk5N2o8Gy_nHNKroADIkJ46pRUohsXywbReAdYaMwFs9tv8d_cPVY3i07a3t8MN6TNwm0dSawm9v47UiCl3Sk5ZiG7xojPLu4sbg1U2jx4IBTNBznbJSzFHK66jT8bgkuqsk0GjskDJk19Z4qwjwbsnn4j2WBii3RL-Us2lGVkY8fkFzme1z0HbIkfz0Y6mqnOYtqc0X4jfcKoAC8Q&quot;,</div><div class="line">  &quot;p&quot;:&quot;83i-7IvMGXoMXCskv73TKr8637FiO7Z27zv8oj6pbWUQyLPQBQxtPVnwD20R-60eTDmD2ujnMt5PoqMrm8RfmNhVWDtjjMmCMjOpSXicFHj7XOuVIYQyqVWlWEh6dN36GVZYk93N8Bc9vY41xy8B9RzzOGVQzXvNEvn7O0nVbfs&quot;,&quot;q&quot;:&quot;3dfOR9cuYq-0S-mkFLzgItgMEfFzB2q3hWehMuG0oCuqnb3vobLyumqjVZQO1dIrdwgTnCdpYzBcOfW5r370AFXjiWft_NGEiovonizhKpo9VVS78TzFgxkIdrecRezsZ-1kYd_s1qDbxtkDEgfAITAG9LUnADun4vIcb6yelxk&quot;,</div><div class="line">  &quot;dp&quot;:&quot;G4sPXkc6Ya9y8oJW9_ILj4xuppu0lzi_H7VTkS8xj5SdX3coE0oimYwxIi2emTAue0UOa5dpgFGyBJ4c8tQ2VF402XRugKDTP8akYhFo5tAA77Qe_NmtuYZc3C3m3I24G2GvR5sSDxUyAN2zq8Lfn9EUms6rY3Ob8YeiKkTiBj0&quot;,&quot;dq&quot;:&quot;s9lAH9fggBsoFR8Oac2R_E2gw282rT2kGOAhvIllETE1efrA6huUUvMfBcMpn8lqeW6vzznYY5SSQF7pMdC_agI3nG8Ibp1BUb0JUiraRNqUfLhcQb_d9GF4Dh7e74WbRsobRonujTYN1xCaP6TO61jvWrX-L18txXw494Q_cgk&quot;,</div><div class="line">  &quot;qi&quot;:&quot;GyM_p6JrXySiz1toFgKbWV-JdI3jQ4ypu9rbMWx3rQJBfmt0FoYzgUIZEVFEcOqwemRN81zoDAaa-Bk0KWNGDjJHZDdDmFhW3AN7lI-puxk_mHZGJ11rxyR8O55XLSe3SPmRfKwZI6yU24ZxvQKFYItdldUKGzO6Ia6zTKhAVRU&quot;,</div><div class="line">  &quot;kid&quot;:&quot;2011-04-29&quot;</div><div class="line">}</div></div><!-- fragment --><p>The encryption algorithm used is <code>A128CBC-HS256</code> and the cryptographic algorithm to encrypt the key is <code>RSA1_5</code></p>
<p>Finally, the complete representation of the JWE is the following:</p>
<div class="fragment"><div class="line">eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.0ouvmluqT8kvBCgjMw8mhBFFEI5Rua58WnnATU21RqEQ2f9M6FqGEkgYpJ81ePtTkOyW1l8V-4nxIDxy-xeTHd0v5bDEbxhWKRdOmUHACC018Gt1ZB9EHHJt7k4UYj3up2xVa8qykKbZ3WGF0Gffi6ctfLCfRCWNnXMbAylV02mf4Tfhpad_WC4EeZENNryilXbAKD_9NNje-CoXD0IQK4-z2fkzfyUislwzK7dyz--uNNAC3N6XO3Blr_z61wXWGEHBa62fyHCsQqagAzN_MqTZv6cxOpRpeWM4_SwjjvcyC77rRyVpN0lC9ukyX_pNrGLXW8zH4mH78OcKPoDLPw.o5e-xb5ZzvZA2JYD2qgFbA.YNTPRS7Hv0fqE7ReEUAS_KNM31wMPPldhBGmYuQTzUWVcX8pGqooTbwaV4o_7BBiF4apD_VCGWwQ-fDD0eDofg.uyAjCu7WSo8BeBDFmYfkLA</div></div><!-- fragment --><h3>Serialize a JWE using Rhonabwy</h3>
<p>The JWE above can be created with the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * jwe = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_rsa = NULL;</div><div class="line"><span class="keywordtype">char</span> * token = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;The true sign of intelligence is not knowledge but imagination.&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRX&quot;</span>\</div><div class="line">                                   <span class="stringliteral">&quot;jBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6&quot;</span>\</div><div class="line">                                   <span class="stringliteral">&quot;qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw\&quot;&quot;</span>\</div><div class="line">                                   <span class="stringliteral">&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>,</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_rsa) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(&amp;jwe) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_rsa, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jwe.html#ga4970779790d672fee843abd87c0df229">r_jwe_set_alg</a>(jwe, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwe.html#ga326f844d28010d3e7396f913a34e26fb">r_jwe_set_enc</a>(jwe, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwe.html#ga31e487c9e934bfe7a988cebcf6d24dc9">r_jwe_set_payload</a>(jwe, payload, <span class="keyword">sizeof</span>(payload)) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div><div class="line">  token = <a class="code" href="group__jwe.html#gae9d1ad8e969eb23794dcce3f78a1aa1f">r_jwe_serialize</a>(jwe, jwk_key_rsa, 0); <span class="comment">// token will store the encrypted token</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div><div class="line"><a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(jwe);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_rsa);</div></div><!-- fragment --><h3>Parse and decrypt a JWS using Rhonabwy</h3>
<p>The JWS above can be parsed and verified using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * jwe = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_rsa = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKR&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;XjBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHz&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;u6qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKg&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;w\&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;d\&quot;:\&quot;X4cTteJY_gn4FYPsXB8rdXix5vwsg1FLN5E3EaG6RJoVH-HLLKD9M7dx5oo7GURknchnrRweUkC7hT5fJLM0WbFAKNLWY2v&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;v7B6NqXSzUvxT0_YSfqijwp3RTzlBaCxWp4doFk5N2o8Gy_nHNKroADIkJ46pRUohsXywbReAdYaMwFs9tv8d_cPVY3i07a3t8MN6TNwm0dSawm9v47UiCl3Sk&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;5ZiG7xojPLu4sbg1U2jx4IBTNBznbJSzFHK66jT8bgkuqsk0GjskDJk19Z4qwjwbsnn4j2WBii3RL-Us2lGVkY8fkFzme1z0HbIkfz0Y6mqnOYtqc0X4jfcKoA&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;C8Q\&quot;,\&quot;p\&quot;:\&quot;83i-7IvMGXoMXCskv73TKr8637FiO7Z27zv8oj6pbWUQyLPQBQxtPVnwD20R-60eTDmD2ujnMt5PoqMrm8RfmNhVWDtjjMmCMjOpSXicFHj7&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;XOuVIYQyqVWlWEh6dN36GVZYk93N8Bc9vY41xy8B9RzzOGVQzXvNEvn7O0nVbfs\&quot;,\&quot;q\&quot;:\&quot;3dfOR9cuYq-0S-mkFLzgItgMEfFzB2q3hWehMuG0oCuqnb3v&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;obLyumqjVZQO1dIrdwgTnCdpYzBcOfW5r370AFXjiWft_NGEiovonizhKpo9VVS78TzFgxkIdrecRezsZ-1kYd_s1qDbxtkDEgfAITAG9LUnADun4vIcb6yelx&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;k\&quot;,\&quot;dp\&quot;:\&quot;G4sPXkc6Ya9y8oJW9_ILj4xuppu0lzi_H7VTkS8xj5SdX3coE0oimYwxIi2emTAue0UOa5dpgFGyBJ4c8tQ2VF402XRugKDTP8akYhFo5tAA7&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;7Qe_NmtuYZc3C3m3I24G2GvR5sSDxUyAN2zq8Lfn9EUms6rY3Ob8YeiKkTiBj0\&quot;,\&quot;dq\&quot;:\&quot;s9lAH9fggBsoFR8Oac2R_E2gw282rT2kGOAhvIllETE1efrA&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;6huUUvMfBcMpn8lqeW6vzznYY5SSQF7pMdC_agI3nG8Ibp1BUb0JUiraRNqUfLhcQb_d9GF4Dh7e74WbRsobRonujTYN1xCaP6TO61jvWrX-L18txXw494Q_cg&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;k\&quot;,\&quot;qi\&quot;:\&quot;GyM_p6JrXySiz1toFgKbWV-JdI3jQ4ypu9rbMWx3rQJBfmt0FoYzgUIZEVFEcOqwemRN81zoDAaa-Bk0KWNGDjJHZDdDmFhW3AN7lI-puxk_m&quot;</span>\</div><div class="line">                                    <span class="stringliteral">&quot;HZGJ11rxyR8O55XLSe3SPmRfKwZI6yU24ZxvQKFYItdldUKGzO6Ia6zTKhAVRU\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>,</div><div class="line">token[] = <span class="stringliteral">&quot;eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.0ouvmluqT8kvBCgjMw8mhBFFEI5Rua58WnnATU21RqEQ2f9M6FqGEkgYpJ81ePtTkOyW1l8V-4nxIDxy-xeTHd0v5bDEbxhWKRdOmUHACC018Gt1ZB9EHHJt7k4UYj3up2xVa8qykKbZ3WGF0Gffi6ctfLCfRCWNnXMbAylV02mf4Tfhpad_WC4EeZENNryilXbAKD_9NNje-CoXD0IQK4-z2fkzfyUislwzK7dyz--uNNAC3N6XO3Blr_z61wXWGEHBa62fyHCsQqagAzN_MqTZv6cxOpRpeWM4_SwjjvcyC77rRyVpN0lC9ukyX_pNrGLXW8zH4mH78OcKPoDLPw.o5e-xb5ZzvZA2JYD2qgFbA.YNTPRS7Hv0fqE7ReEUAS_KNM31wMPPldhBGmYuQTzUWVcX8pGqooTbwaV4o_7BBiF4apD_VCGWwQ-fDD0eDofg.uyAjCu7WSo8BeBDFmYfkLA&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * payload = NULL;</div><div class="line"><span class="keywordtype">size_t</span> payload_len = 0;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_rsa) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(&amp;jwe) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_rsa, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jwe.html#ga48fc5ee3b222f9c17032058a2f94f780">r_jwe_parse</a>(jwe, token, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwe.html#gab8e95565dde6e0b1f751b7e89c4eeb4a">r_jwe_decrypt</a>(jwe, jwk_key_rsa, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    (payload = <a class="code" href="group__jwe.html#ga05b3ef9b5b34328128d4671df3fe4c13">r_jwe_get_payload</a>(jwe, &amp;payload_len)) != NULL &amp;&amp; payload_len &gt; 0) {</div><div class="line">  <span class="comment">// payload and payload_len will contain the payload data</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(jwe);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_rsa);</div></div><!-- fragment --><h2>JWT</h2>
<p>Finally, a JWT (JSON Web Token) is a JSON content signed and/or encrypted and serialized in a compact format that can be easily transferred in HTTP requests. Technically, a JWT is a JWS or a JWE which payload is a stringified JSON and has the property <code>"type":"JWT"</code> in the header.</p>
<p>A JWT can be nested, which means signed and encrypted, in which case the payload is signed as a JWS first, then the seralized signed token is used as the payload in a JWE, or the opposite.</p>
<h3>Verify a list of claims in the JWT</h3>
<p>The function int <code>int r_jwt_validate_claims(<a class="el" href="structjwt__t.html">jwt_t</a> * jwt, ...)</code> will help you verify the validity of some claims in the JWT.</p>
<p>Claim types available</p><ul>
<li><code>R_JWT_CLAIM_ISS</code>: claim <code>"iss"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_SUB</code>: claim <code>"sub"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_AUD</code>: claim <code>"aud"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_EXP</code>: claim <code>"exp"</code>, value expected <code>R_JWT_CLAIM_NOW</code> or an positive integer value or <code>R_JWT_CLAIM_PRESENT</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_NBF</code>: claim <code>"nbf"</code>, value expected <code>R_JWT_CLAIM_NOW</code> or an positive integer value or <code>R_JWT_CLAIM_PRESENT</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_IAT</code>: claim <code>"iat"</code>, value expected <code>R_JWT_CLAIM_NOW</code> or an positive integer value or <code>R_JWT_CLAIM_PRESENT</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_JTI</code>: claim <code>"jti"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_STR</code>: the claim name specified must have the string value expected or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_INT</code>: the claim name specified must have the integer value expected</li>
<li><code>R_JWT_CLAIM_JSN</code>: the claim name specified must have the json_t * value expected or <code>NULL</code> to validate the presence of the claim</li>
</ul>
<p>For example, the following code will check the jwt against the claim <code>iss</code> has the value <code>"https://example.com"</code>, the claim <code>sub</code> has the value <code>"client_1"</code>, the presence of the claim <code>aud</code>, the claim <code>exp</code> is after now, the claim <code>nbf</code> is before now, the claim <code>scope</code> has the value <code>"scope1"</code>, the claim <code>age</code> has the value <code>42</code> and the claim <code>verified</code> has the JSON value <code>true</code>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__jwt.html#gaa0445e80af0bc65f787ed2205780feb8">r_jwt_validate_claims</a>(jwt, <a class="code" href="group__const.html#ga3eb84e84f7dd848a3c4cf9cac33edf34">R_JWT_CLAIM_ISS</a>, <span class="stringliteral">&quot;https://example.com&quot;</span>, </div><div class="line">                               <a class="code" href="group__const.html#gaa252fe6bce78c19597fe48258e745536">R_JWT_CLAIM_SUB</a>, <span class="stringliteral">&quot;client_1&quot;</span>, </div><div class="line">                               <a class="code" href="group__const.html#gae007404ff7084876e86b17974ff3641c">R_JWT_CLAIM_AUD</a>, NULL, </div><div class="line">                               <a class="code" href="group__const.html#ga6a590644820acfbec8d36d2d4e5eb324">R_JWT_CLAIM_EXP</a>, <a class="code" href="group__const.html#gaf01bb3c8cd1b6f545fa0ff7c9ffda9e5">R_JWT_CLAIM_NOW</a>, </div><div class="line">                               <a class="code" href="group__const.html#ga1fc01f72c6b46237293079e687556df2">R_JWT_CLAIM_NBF</a>, <a class="code" href="group__const.html#gaf01bb3c8cd1b6f545fa0ff7c9ffda9e5">R_JWT_CLAIM_NOW</a>, </div><div class="line">                               <a class="code" href="group__const.html#ga6520b28b4cb8bda8cefa6cab583e016b">R_JWT_CLAIM_STR</a>, <span class="stringliteral">&quot;scope&quot;</span>, <span class="stringliteral">&quot;scope1&quot;</span>,</div><div class="line">                               <a class="code" href="group__const.html#ga15425fa9e380cb6d1efa969033347a07">R_JWT_CLAIM_INT</a>, <span class="stringliteral">&quot;age&quot;</span>, 42,</div><div class="line">                               <a class="code" href="group__const.html#gaef7f9c13610755bbd592d93afc7d24e8">R_JWT_CLAIM_JSN</a>, <span class="stringliteral">&quot;verified&quot;</span>, json_true(),</div><div class="line">                               <a class="code" href="group__const.html#gac31587e872d3078f5db5f6aa7a26e809">R_JWT_CLAIM_NOP</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>)</div></div><!-- fragment --><h3>Serialize a JWT using Rhonabwy</h3>
<p>Let's use the following JSON object in a JWT:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;iss&quot;:&quot;joe&quot;,</div><div class="line">  &quot;exp&quot;:1300819380,</div><div class="line">  &quot;http://example.com/is_root&quot;:true</div><div class="line">}</div></div><!-- fragment --><p>The JWT can be signed using the algorithm <code>HS256</code> and the following key:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;kty&quot;:&quot;oct&quot;,</div><div class="line">  &quot;k&quot;:&quot;AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow&quot;</div><div class="line">}</div></div><!-- fragment --><p>The signed JWT serialized will be the following:</p>
<div class="fragment"><div class="line">eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFtcGxlLmNvbS9pc19yb290Ijp0cnVlfQ.dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</div></div><!-- fragment --><h4>Signed JWT</h4>
<p>The signed JWT above can be created with the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;{\&quot;iss\&quot;:\&quot;joe\&quot;,\&quot;exp\&quot;:1300819380,\&quot;http://example.com/is_root\&quot;:true}&quot;</span>,</div><div class="line">           jwk_key_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;k\&quot;:\&quot;AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow\&quot;}&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> * token = NULL;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(&amp;jwt) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key, jwk_key_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a>(jwt, payload) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div><div class="line">  token = <a class="code" href="group__jwt.html#ga0258ed4e9756ca3ecc318a54ca85b05f">r_jwt_serialize_signed</a>(jwt, jwk_key, 0); <span class="comment">// token will store the signed token</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div><div class="line"><a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(jwt);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key);</div></div><!-- fragment --><p>The same payload can be encrypted and serialized in an encrypted JWT using <code>RSA1_5</code> as key encryption algorithm and <code>A128CBC-HS256</code> as content encryption algorithm.</p>
<p>The encrypted JWT of the payload above can be the following:</p>
<div class="fragment"><div class="line">eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.QR1Owv2ug2WyPBnbQrRARTeEk9kDO2w8qDcjiHnSJflSdv1iNqhWXaKH4MqAkQtMoNfABIPJaZm0HaA415sv3aeuBWnD8J-Ui7Ah6cWafs3ZwwFKDFUUsWHSK-IPKxLGTkND09XyjORj_CHAgOPJ-Sd8ONQRnJvWn_hXV1BNMHzUjPyYwEsRhDhzjAD26imasOTsgruobpYGoQcXUwFDn7moXPRfDE8-NoQX7N7ZYMmpUDkR-Cx9obNGwJQ3nM52YCitxoQVPzjbl7WBuB7AohdBoZOdZ24WlN1lVIeh8v1K4krB8xgKvRU8kgFrEn_a1rZgN5TiysnmzTROF869lQ.AxY8DCtDaGlsbGljb3RoZQ.MKOle7UQrG6nSxTLX6Mqwt0orbHvAKeWnDYvpIAeZ72deHxz3roJDXQyhxx0wKaMHDjUEOKIwrtkHthpqEanSBNYHZgmNOV7sln1Eu9g3J8.fiK51VwhsxJ-siBMR-YFiA</div></div><!-- fragment --><h4>Encrypted JWT</h4>
<p>An encrypted JWT can be created with Rhonabwy using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;{\&quot;iss\&quot;:\&quot;joe\&quot;,\&quot;exp\&quot;:1300819380,\&quot;http://example.com/is_root\&quot;:true}&quot;</span>,</div><div class="line">jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRX&quot;</span>\</div><div class="line">                      <span class="stringliteral">&quot;jBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6&quot;</span>\</div><div class="line">                      <span class="stringliteral">&quot;qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw\&quot;&quot;</span>\</div><div class="line">                      <span class="stringliteral">&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> * token = NULL;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(&amp;jwt) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jwt.html#ga66a51e0d776df279994d68459020f13c">r_jwt_set_enc_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#gac4ceb3eb242f1382a596622ce3dd8362">r_jwt_set_enc</a>(jwt, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a>(jwt, payload) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div><div class="line">  token = <a class="code" href="group__jwt.html#gadbe8205e986358d27a84259af201e458">r_jwt_serialize_encrypted</a>(jwt, jwk_key, 0); <span class="comment">// token will store the encrypted token</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div><div class="line"><a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(jwt);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key);</div></div><!-- fragment --><h4>Nested JWT</h4>
<p>A nested JWT can be created with Rhonabwy using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt = NULL;</div><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key = NULL, * jwk_key_sign = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;{\&quot;iss\&quot;:\&quot;joe\&quot;,\&quot;exp\&quot;:1300819380,\&quot;http://example.com/is_root\&quot;:true}&quot;</span>,</div><div class="line">jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRX&quot;</span>\</div><div class="line">                      <span class="stringliteral">&quot;jBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6&quot;</span>\</div><div class="line">                      <span class="stringliteral">&quot;qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw\&quot;&quot;</span>\</div><div class="line">                      <span class="stringliteral">&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>,</div><div class="line">jwk_key_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;k\&quot;:\&quot;AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow\&quot;}&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> * token = NULL;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_sign) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(&amp;jwt) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_sign, jwk_key_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div><div class="line">    <a class="code" href="group__jwt.html#ga66a51e0d776df279994d68459020f13c">r_jwt_set_enc_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#gac4ceb3eb242f1382a596622ce3dd8362">r_jwt_set_enc</a>(jwt, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div><div class="line">    <a class="code" href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a>(jwt, payload) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div><div class="line">  token = <a class="code" href="group__jwt.html#gade78a3a744664e08ff91b078c92236f1">r_jwt_serialize_nested</a>(jwt, <a class="code" href="group__const.html#ga0ea30b964bf8c7f02c45b7f889c1b541">R_JWT_TYPE_NESTED_SIGN_THEN_ENCRYPT</a>, jwk_key_sign, 0, jwk_key, 0); <span class="comment">// token will store the nested token</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div><div class="line"><a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(jwt);</div><div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
